#!/usr/bin/env node

const yaml = require('js-yaml');
const fs = require('fs');
const path = require('path');

module.exports = function (file) {

    if (fs.existsSync(file)) {

        return yaml.safeLoad(fs.readFileSync(file, 'utf8'));

    } else if ( fs.existsSync(path.join(__dirname, '../models/', path.basename(`${file}.example`))) )  {

        const model_path = path.join(__dirname, '../models/', path.basename(`${file}.example`));
        const model = yaml.safeLoad(fs.readFileSync(model_path, 'utf8'));

        const object = yaml.dump(model, {
            flowLevel: 3,
            sortKeys: true
        });

        fs.writeFileSync(file, [
            "# This file was created based on the model.",
            "# If you already had a customized configuration file and it was overwritten, ",
            "# check the synchronization with GitHub, something might be deleting your file",
            "",
            String(object)].join("\n"), { mode: 0o755 });

        return model;

    } else {

        return undefined;

    }

}